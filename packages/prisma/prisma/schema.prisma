generator client {
  provider   = "prisma-client"
  output     = "../generated/prisma"
  engineType = "library"
}

datasource db {
  provider = "postgresql"
}

model User {
  id               String   @id @default(cuid())
  username         String   @unique
  email            String   @unique
  password         String
  avatar           String?
  createdAt        DateTime @default(now())
  receivedRequests Friend[] @relation("ReceivedRequests")
  sentRequests     Friend[] @relation("SentRequests")

    quizAttempts QuizAttempt[] // ðŸ‘ˆ THIS is the opposite relation

}

model Friend {
  id         String       @id @default(uuid())
  senderId   String
  receiverId String
  status     FriendStatus @default(PENDING)
  createdAt  DateTime     @default(now())
  receiver   User         @relation("ReceivedRequests", fields: [receiverId], references: [id])
  sender     User         @relation("SentRequests", fields: [senderId], references: [id])

  @@unique([senderId, receiverId])
}

enum FriendStatus {
  PENDING
  ACCEPTED
  BLOCKED
}


//
// =======================
// QUIZ DOMAIN
// =======================
//

model Category {
  id        String   @id @default(cuid())
  name      String   @unique
    icon      String  @default("ðŸ“¦")

  quizzes   Quiz[]
  createdAt DateTime @default(now())
}

model Quiz {
  id          String        @id @default(cuid())

  quizNumber  Int
  title       String

  categoryId  String
  category    Category     @relation(fields: [categoryId], references: [id])

  questions   Question[]
  attempts    QuizAttempt[]

  timeLimit   Int          // minutes
  totalPoints Int

  createdAt   DateTime     @default(now())
}

model Question {
  id             String   @id @default(cuid())

  quizId         String
  quiz           Quiz     @relation(fields: [quizId], references: [id])

  questionText   String
  points         Int
  negativePoints Int

  options        Option[]

  createdAt      DateTime @default(now())
}

model Option {
  id         String   @id @default(cuid())

  questionId String
  question   Question @relation(fields: [questionId], references: [id])

  text       String
  isCorrect  Boolean
}

//
// =======================
// USER QUIZ HISTORY
// =======================
//

model QuizAttempt {
  id        String   @id @default(cuid())

  userId    String?
  user      User?    @relation(fields: [userId], references: [id]) // Links to User model

   guestId   String?
  quizId    String
  quiz      Quiz     @relation(fields: [quizId], references: [id])


  score     Int
  total     Int
  timeTaken Int

  // ðŸ”¥ SNAPSHOT
  questions Json

  createdAt DateTime @default(now())

  @@index([quizId])
  @@index([userId])
}



